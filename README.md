📘 在线报修系统 — 开发说明文档（当前进度版）
1. 项目简介

在线报修系统是一个帮助学校、企业或组织在线提交维修申请、由工程师接单并处理的系统。包含角色：

普通用户（上报设备故障）

工程师（负责区域，查看、处理工单）

管理员（管理用户、角色、区域、设备、工单）

系统包括：用户管理、角色权限、区域层级管理、工单上报与流转、统计等。

本项目基于 Spring Boot + Spring Security + JWT + JPA + MySQL 实现后端 API，未来可配套 Vue 或 React 实现前端。

2. 技术栈说明
✔ 后端技术

Spring Boot 3.x

Spring Security + JWT（用户认证与权限控制）

Spring Data JPA（ORM 映射）

MySQL（数据库）

Lombok（简化开发）

Swagger / OpenAPI（接口文档）

✔ 前端技术（未来规划）

Vue3 / React（待定）

Ant Design / Element Plus（待定）

3. 当前数据结构设计（已完成）

你已经完成了系统核心的数据结构，包括：

✔ 用户与角色体系

users（用户）

user_role（角色）

user_role_rel（用户-角色关系）

并支持用户多角色，例如用户可以同时是：

管理员（ADMIN）

工程师（ENGINEER）

✔ 区域层级（草稿）

层级为：

楼栋 → 楼层

实体类部分已经在生成中，例如 building、floor。

4. 当前已完成模块
✔ 4.1 用户管理模块（基础版本）

用户增删改查（CRUD）

注册与密码加密（BCrypt）

用户多角色设计（多对多）

✔ 4.2 角色管理模块（基础版本）

角色增删改查

查询用户角色

为用户分配角色（assignRoles）

✔ 4.3 用户认证系统

JWT 登录

JWT 过滤器

全局认证

Spring Security 基础配置

✔ 4.4 Swagger API 文档

你已经有 Swagger API 文档输出能力，可用于调试。

5. 当前正在开发的模块（进行中）
🔧 5.1 角色权限体系完善

近期你正在处理：

删除角色返回 403（因为需要 ADMIN 权限）

修复 assignRoles 的事务问题

对角色操作设置 admin-only 权限

角色与用户关系更新的报错（EntityManager remove 无事务）

🔧 5.2 测试阶段遇到的问题整理与修复

你已经提出的问题包括：

JSON 数组 vs JSON 对象（[] 与 {} 区别）

删除用户是否需要删除关联角色

Content-Type 导致的 415 错误

Spring Security 的权限规则放置位置

这些属于 “用户模块 + 角色模块” 的深化完善阶段。

6. 待开发模块（完整功能蓝图）
🟦 6.1 区域管理模块（未完成）

校区/楼栋/楼层/教室/设备的 CRUD

工程师负责区域的绑定

根据区域筛选工单

🟥 6.2 工单（报修）模块（核心业务）

该模块未开发，是系统的核心：

普通用户提交工单（设备 + 描述 + 图片）

工程师查看负责区域的待处理工单

工程师接单、处理、完成

管理员查看全部工单

支持状态流转：

待处理 → 已接单 → 处理中 → 已完成/已取消（一共五种状态）

🟨 6.3 统计报表（非必需，但常用）

工程师处理量排名

常见故障类型统计

区域故障统计

🟩 6.4 系统与日志模块（可选）

操作日志

工单消息通知（邮件/消息推送）

7. 当前开发进度（百分比）

根据一个典型在线报修系统包含的模块，可粗略估算：

模块	权重	完成度	得分
用户管理	10%	80%	8%
角色/权限	15%	70%	10.5%
区域管理	20%	20%	4%
工单系统（核心）	35%	0%	0%
统计报表	10%	0%	0%
通知系统/日志	10%	0%	0%
🎯 当前总体进度 ≈ 22% - 25%

你已经完成了：

登录 / 权限体系基础

用户与角色系统

API 文档

Spring Security 框架
这些都是系统最难也最底层的部分。

剩下的主要是业务功能开发。

8. 下一步开发建议（按顺序）
① 完成角色权限体系的细化（你当前正在做）

控制 /api/roles/** 只允许 ADMIN 访问

修复 assignRoles 时的事务问题（加上 @Transactional）

② 完成区域管理模块（重要）

完成校区 → 设备实体类与 CRUD

工程师绑定负责区域

③ 开发工单模块（核心）

工单实体类

工单提交 API

工单状态流转

工程师的“我的工单”

④ 开发前端页面（若需要）

用户端：报修页面、我的工单

工程师端：待处理工单、处理工单

管理端：用户管理、角色管理、区域管理、工单管理

📌 总结

你已经成功完成了系统中最底层、最复杂的部分：

✔ 用户体系
✔ 角色体系
✔ JWT 登录
✔ Spring Security 框架
✔ Swagger 文档

接下来主要是围绕业务开发即可。

如果你愿意，我可以继续帮你：

📌 给出完整的项目目录结构规划
📌 为你自动生成全部模块的 API 设计
📌 为你生成工单系统的数据库表结构
📌 自动生成区域管理模块的实体类 + Service + Controller 示例
📌 帮你写一份可用于答辩/报告的项目设计文档